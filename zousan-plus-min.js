!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).Zousan=n()}(this,function(){"use strict";const t=void 0,n=t,e=(()=>{const n=[],e=1024;let o=0;function i(){for(;n.length-o;){try{n[o]()}catch(t){r.error(t)}n[o++]=t,o==e&&(n.splice(0,e),o=0)}}const c=(()=>{if("undefined"!=typeof MutationObserver){const t=document.createElement("div");return new MutationObserver(i).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}return"undefined"!=typeof process&&"function"==typeof process.nextTick?function(){process.nextTick(i)}:"undefined"!=typeof setImmediate?function(){setImmediate(i)}:function(){setTimeout(i,0)}})();return t=>{n.push(t),n.length-o==1&&c()}})();function r(t){if(!(this instanceof r))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof t){const n=this;try{t(t=>n.resolve(t),t=>n.reject(t))}catch(t){n.reject(t)}}else if(arguments.length>0)throw new TypeError("Zousan resolver "+t+" is not a function")}function o(n,e){if("function"==typeof n.y)try{const r=n.y.call(t,e);n.p.resolve(r)}catch(e){n.p.reject(e)}else n.p.resolve(e)}function i(n,e){if("function"==typeof n.n)try{const r=n.n.call(t,e);n.p.resolve(r)}catch(e){n.p.reject(e)}else n.p.reject(e)}r.prototype={resolve:function(t){if(this.state!==n)return;if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));const r=this;if(t&&("function"==typeof t||"object"==typeof t)){let n=!0;try{const e=t.then;if("function"==typeof e)return void e.call(t,function(t){n&&(n=!1,r.resolve(t))},function(t){n&&(n=!1,r.reject(t))})}catch(t){return void(n&&this.reject(t))}}this.state="fulfilled",this.v=t,r.c&&e(function(){for(let n=0,e=r.c.length;n<e;n++)o(r.c[n],t)})},reject:function(t){if(this.state!==n)return;const o=this;this.state="rejected",this.v=t;const c=this.c;e(c?function(){for(let n=0,e=c.length;n<e;n++)i(c[n],t)}:function(){o.handled||r.suppressUncaughtRejectionError||r.warn("You upset Zousan. Please catch rejections: ",t,t?t.stack:null)})},then:function(t,c){const u=new r,f={y:t,n:c,p:u};if(this.state===n)this.c?this.c.push(f):this.c=[f];else{const t=this.state,n=this.v;this.handled=!0,e(function(){"fulfilled"===t?o(f,n):i(f,n)})}return u},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,n){n=n||"Timeout";const e=this;return new r(function(r,o){setTimeout(function(){o(Error(n))},t),e.then(function(t){r(t)},function(t){o(t)})})}},r.resolve=t=>new r(n=>n(t)),r.reject=function(t){const n=new r;return n.c=[],n.reject(t),n},r.all=function(t){const n=[],e=new r;let o=0;function i(i,c){i&&"function"==typeof i.then||(i=r.resolve(i)),i.then(function(r){n[c]=r,++o==t.length&&e.resolve(n)},function(t){e.reject(t)})}for(let n=0;n<t.length;n++)i(t[n],n);return t.length||e.resolve(n),e};const c=()=>{};function u(t,n,e,r){return e[n]=r,n++,t.length>n?f(t,n,e,r):r}function f(t,n,e,r){var o=t[n];return"function"==typeof o&&(o=o.call(null,r)),o&&o.then?o.then(function(r){return u(t,n,e,r)}):u(t,n,e,o)}function s(t){if(t){(arguments.length>1||!Array.isArray(t))&&(t=Array.prototype.slice.call(arguments));var n=new r,e=[];return r.soon(function(){try{n.resolve(f(t,0,e))}catch(t){n.reject(t)}}),{prom:n,res:e}}}r.warn="undefined"!=typeof console?console.warn:c,r.error="undefined"!=typeof console?console.error:c,r.soon=e;var l=["cb","callback","done","callback_"];function a(t,n){if(n.promisifyAll)return!0;if(n.fnNames)return n.fnNames.indexOf(t.name)>=0;var e=n.cbArgNames||l,r=function(t){var n=t.toString().match(/function\s.*?\(([^)]*)\)/);return!n||n.length<2?null:n[1].replace(/\/\*.*\*\//,"").split(",").map(h)}(t);if(r&&r.length){var o=r[r.length-1];if(e.indexOf(o)>=0)return!0}return!1}function p(t){return function(){var n=Array.prototype.splice.call(arguments,0),e=this;return new r(function(r,o){n.push(function(t,n){t?o(t):r(n)}),t.apply(e,n)})}}function h(t){return t.trim()}return r.PROMISIFY_FN_EXTENSION="Prom",r.evaluate=function(t){Array.isArray(t)||(t=Array.prototype.slice.call(arguments));var n={};t.forEach(function(t,e){n[t.name||"_p"+e]=r.all((t.deps||[]).map(function(t){return"string"==typeof t&&t in n?n[t]:t})).then(function(n){var e=t.value;return"function"==typeof e&&(e=e.apply(null,n)),e})});var e=Object.keys(n),o=e.map(function(t){return n[t]});return r.all(o).then(function(t){var n={};return e.forEach(function(e,r){n[e]=t[r]}),n})},r.map=function t(n,e){if(n.then)return n.then(function(n){return t(n,e)});if(n.map)return function(t,n){return r.all(t.map(function(t){return t.then?t.then(n):n(t)}))}(n,e);throw Error("first argument must be a promise or an iterable")},r.namedAll=function(t){var n=Object.keys(t),e=n.map(function(n){return"function"==typeof t[n]?t[n].apply(null):t[n]});return r.all(e).then(function(t){var e={};return n.forEach(function(n,r){e[n]=t[r]}),e})},r.promisify=function(t,n){if(n=n||{},"function"==typeof t)return p(t);for(var e in t)"function"==typeof t[e]&&a(t[e],n)&&(t[e+r.PROMISIFY_FN_EXTENSION]=p(t[e]));return t},r.promisifyFn=p,r.series=function(){return s.apply(null,arguments).prom},r.tSeries=s,r});
//# sourceMappingURL=zousan-plus-min.js.map
